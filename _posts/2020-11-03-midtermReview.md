데이터베이스 프로그래밍 과목에서 중간 대체로 "데이터셋에서 유의미한 정보 3개를 찾아 웹 사이트 만들기" 라는 과제가 나왔다. CSS도 필요 없다고 하셨고 그냥 정량적인 평가를 한다고 했으므로 부담스러운 과제는 아니였다. 
그런데 하다보니 화려하진 않더라도 가독성 있는 페이지를 만들고 싶다는 생각이 들어 1학년 때의 기억을 끄집어내서 간단하게 나마 CSS를 입히고 새로운 데이터도 만들었다. 

1. 메인 화면
![image](https://user-images.githubusercontent.com/69361613/97792291-ba4b6800-1c1f-11eb-891a-152e68a0c897.png)
1-1. 카테고리별 인기 비디오 리스트
![image](https://user-images.githubusercontent.com/69361613/97792304-dcdd8100-1c1f-11eb-839b-ef7184393fbf.png)
1-2. 사용자가 검색한 해시태그에 맞는 비디오 리스트
![image](https://user-images.githubusercontent.com/69361613/97792326-072f3e80-1c20-11eb-863d-8fd4158f9ff3.png)
1-3. 기간별 트렌딩 비디오 리스트
![image](https://user-images.githubusercontent.com/69361613/97792340-2c23b180-1c20-11eb-8049-c682813dcd5a.png)
2. 트렌딩 횟수가 가장 많은 채널 TOP 50 
![image](https://user-images.githubusercontent.com/69361613/97839703-0d0f4780-1d26-11eb-9441-99e99bd31bbe.png)
3. 사용자 선호도에 따른 카테고리 순위
![image](https://user-images.githubusercontent.com/69361613/97839843-5495d380-1d26-11eb-9abf-f2c7c23611c5.png)

2번과 3

## 배운 내용, 오류 발생 + 해결 과정
너무 너무 많았지만, 몇 가지를 추려보면..

1. **KAGGLE**  
교수님이 과제를 해결할 때 쓸만한 데이터로 캐글을 추천해주셨다. 세상에 이렇게 많은 데이터가 존재한다는 것을 알았고, 이 데이터를 꼭 써보고 싶다는 생각이 들었다. 
api, json 등 가져오는 방법이 많은 것 같았는데 과제를 빨리 해야했으므로 csv 파일로 가져오기로 했다. 간단할 거라고 생각했으니까..
2. **CSV 파일 MariaDB로 import 하기**  
그 중에서도 가져오고 싶은 데이터는 youtube 데이터였다. 구글링을 통해 가져오는 방법을 찾고 (LODA DATA 이용) 입력했는데, 계속 오류가 났다. 특히 "칼럼의 개수보다 데이터가 더 많습니다" 라는 에러가 계속해서 출력되었다. 분명히 데이터셋과 동일한 칼럼을 가진 테이블을 만들어두었는데도 말이다.  
여러 자료와 삽질 끝에 에러의 원인을 알 수 있었다. 데이터를 LOAD 해올 때 구분자를 ","로 하여 가져오는데, 내가 가지고 있는 데이터셋은 "비디오 타이틀" "해시태그" 등에 구분자가 아닌 ","을 포함하고 있기 때문이였다.  
ex. ![image](https://user-images.githubusercontent.com/69361613/97793154-71011580-1c2b-11eb-86ba-771d3088a77a.png)
이를 테면 이런 것..^^ 
","를 다른 문자로 치환하는 방법을 생각해보았지만 원본 데이터를 훼손시키고 싶지 않아 csv 파일을 열어보았다.
![image](https://user-images.githubusercontent.com/69361613/97793169-b9203800-1c2b-11eb-995b-f5339942586d.png)
자세히 보니 데이터 제공자가 이러한 경우를 대비하여 데이터에 ,를 포함하는 경우 해당 데이터를 따옴표("")로 묶어논 것을 확인할 수 있었다. 그래서 LOAD DATA에 ENCLOSED BY '"' 을 추가했고, 성공적으로 데이터를 가져올 수 있었다.
~~~sql 
#사용한 쿼리
LOAD DATA INFILE '/var/www/html/db/krdata.csv' REPLACE INTO TABLE `youtube`.`KR` COLUMNS TERMINATED BY ',' ENCLOSED BY '"' LINES TERMINATED BY '\r\n' IGNORE 1 LINES (video_id, title, pulishedAt, channelId, channelTitle, categoryId, trending_date,tags, view_count, likes, dislikes, comment_count, thumbnail_link);
~~~
3. **링크를 연결하고 싶은데 데이터셋엔 없다.**  
실제 유투브 비디오까지 연결이 되야 더 유의미한 데이터라고 생각을 해서 링크를 걸고 싶었는데 사용하고자 하는 데이터셋에는 유투브 링크를 제공하지 않고 있었다. 
그런데 제공되는 video_Id값이 알파벳+숫자 조합의 스트링이였는데, 이걸 통해서 유투브로 연결하는 링크를 만들 수 있을 거라고 생각이 들어 유투브 링크를 확인해본 결과 예상대로 링크에는 일정한 패턴이 존재했기 때문에 기본값 + 비디오 아이디를 연결하여 링크를 만들 수 있었다. 이렇게..
![image](https://user-images.githubusercontent.com/69361613/97793260-1c5e9a00-1c2d-11eb-99ba-9e2010fb2ee3.png)

4. **중복 데이터가 너무 많다.**  
해당 데이터가 "일별 트렌딩 비디오" 데이터라는 걸 간과했다. 오늘 인기있는 비디오가 내일도 인기있는 비디오라면 두 날짜 모두에 트렌딩 될 수 있다는 뜻이다. 실제로 이런 데이터가 다량 존재했다. BTS나 BLACKPINK와 같은 인기 아이돌들의 비디오가 특히 그랬다. 조회수별로 데이터를 출력해보니 트렌딩 날짜만 다르게, 동일한 비디오가 쭉 출력됐다. (방탄만 10개가 쭉 나왔다..) 처음에는 distinct 키워드를 video_id 앞에 붙이면 해결이 될 거라고 생각해서 시도해봤지만 video_id 단일 데이터를 출력하는 것이 아니라, 트렌딩 날짜까지 출력하고자 했기에 통하지 않았다. (비디오 아이디는 같지만 트렌딩 날짜가 다르므로 다른 데이터로 인식되었음)
그래서 더 오랜 고민 끝에 나온 것이 group by 함수였다. group by 함수를 통해 video_id를 묶으니 최초 트렌딩 기준으로 하나의 데이터만 출력할 수 있었다.

5. **함수를 쓰면 별칭을 정해야한다.**  
|를 #로 바꾸기 위해 replace 함수를 이용하고 mysqli_fetch_array를 반복문을 돌려서 tags 값을 받아오려는데 값이 받아와지지 않았다. 칼럼을 출력해보니 함수를 쓸 경우 칼럼값이 해당 함수 replace(...) 와 같이 변경되기 때문이였다.
as 키워드로 별칭을 정해주고 별칭으로 값을 가져왔더니 해결되었다. 되게 당연한 문제였다.

6. **서브쿼리, UNION, AS SELECT**
가져온 데이터가 단일 테이블을 가지고 있는 데이터셋이였다. 그래서 해당 테이블에서 새로운 정보를 찾은 후 새로운 테이블을 생성하고 출력하는 과정에서 CREATE TABLE ~ AS SELECT, FROM (SELECT ~) 와 같은 서브쿼리, UNION와 같은 다양한 함수들을 복습할 수 있었다.


### 회고
#### +
> 아직 많이 부족하지만 그래도 얼추 웹사이트같은 웹사이트를 만든 것 같아 뿌듯하다. 데이터베이스 과목들을 실습할 때 항상 공식처럼 employees 데이터를 사용했는데 처음으로 다른 데이터를 사용해서 너무 신기하고 재밌었다.

#### -
> 캐글 데이터를 가져오는 데에 많은 시간을 소비했다. 해결을 다 하고 슬랙을 보니 여러 gui 툴들이 있는 것 같았다. 나중에 또 사용하게 된다면 그런 툴들을 이용해서 가져오는 것이 더 시간면에서 경제적일 것 같다. (정신적으로도..) 유난히 특수문자가 많은 데이터를 사용해서 그런지 가져오는게 까다로웠던 것 같다. 그리고 가져온 데이터가 단일 테이블이여서 과제를 하기 좀 곤란했던 것 같다.

#### !
> 처음에 분류 기준만 바꿔서 인기 비디오 리스트를 출력해서 과제를 제출했는데 생각해보니까 분류 기준만 다를 뿐 하나의 정보라는 생각이 들었다. 그래서 수정을 해야겠다는 생각이 들었는데, 캐글에서 가져온 데이터가 하나의 테이블만을 포함하고 있어서 수정하기가 난감했다. 그런데 계속 보다 보니 단일 테이블에서도 새로운 정보가 보였다. 그래서 기존 단일 테이블의 정보를 활용해서 각 채널의 트렌딩 횟수를 저장하는 테이블을 만들 수 있었다. 그리고 기존 단일 테이블에서 제공하는 좋아요, 조회수, 댓글수 정보를 활용해서 '카테고리별 사용자 선호도' 라는 데이터를 만들 수 있었고 그 데이터를 통해 카테고리의 순위를 메길 수 있었다. 내가 직접 데이터를 가공해서 테이블을 만든다는 것이 너무 힘들었지만 정말 뿌듯했다. 
